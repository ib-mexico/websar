<th:block th:fragment="body">
	<div id="appDetalle">

	<div class="block-header">
		<h2>Recursos Activos de IBMEXICO</h2>
	</div>

	<ol class="breadcrumb breadcrumb-bg-red">
		<li><a th:href="${ {_PATH_} + 'controlPanel/'}"><i class="material-icons">home</i> Inicio</a></li>
		<li class="active"><i class="material-icons">public</i> Activos en Mantenimiento</li>
	</ol>

	<div class="row clearfix">
		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
			<div class="card">
				<div class="header">
					<h2>Lista de Activos en Mantenimiento</h2>
				</div>
		
    			<div class="body">
    				<div class="row clearfix">
					<!--<div class="row clearfix" th:if="${rolNuevoCliente}">-->
    					<div class="col-md-4 col-md-offset-8 text-right">
							<!--th:href="${ {_PATH_} + 'controlPanel/activos/create'}" -->
							<a href="#" role="button" class="btn bg-purple waves-effect" 
								data-toggle="modal" data-target="#modalNuevoActivo" v-on:click="loadModal">
								<i class="material-icons">add_circle</i> Nuevo Mantenimiento</a>
    					</div>
					</div>
					
				<!-- Busqueda en rangos de fecha -->

    				<div class="row clearfix" id="dtDetalleToolBar">
    					<div class="col-xs-3 col-sm-3 col-md-3">
    						<div class="input-group">
   								<span class="input-group-addon">
                                	<i class="material-icons">date_range</i>
	                           	</span>
	                           	<div class="form-line" id='groupDesde'>
                               		<input type="text" class="form-control text-center datetimepicker" id="txtBootstrapTableDesde" name="txtBootstrapTableDesde" placeholder="Desde..." />
	                           	</div>
							</div>
    					</div>
    					
    					<div class="col-xs-3 col-sm-3 col-md-3">
    						<div class="input-group">
    							<span class="input-group-addon">
                                	<i class="material-icons">date_range</i>
	                           	</span>
	                           	<div class="form-line" id='groupHasta'>
                               		<input type="text" class="form-control text-center datetimepicker" id="txtBootstrapTableHasta" name="txtBootstrapTableHasta" placeholder="Hasta..." />
	                           	</div>
							</div>
    					</div>					
					</div>



					<div class="table-responsive">
						<table id="dtDetalle" class="table table-bordered table-striped table-hover">
							<thead>
								<tr>
									<th class="col-md-1" data-field="idDetalleMant" data-sortable="true" data-halign="left" data-align="center">Id</th>
									<th class="col-md-2" data-formatter="accionesFormatter" data-align="center" style="display: inline">Acciones</th>
									<th class="col-md-2" data-field="cantidad" data-halign="left">Cantidad</th>
									<th class="col-md-3" data-field="diagnostico" data-halign="left">Diagnostico</th>
									<th class="col-md-2" data-formatter="estatusFormatter" data-halign="center" data-align="center">Estado</th>

                                    <th class="col-md-1" data-field="creacion_fecha" data-halign="left" data-align="center" data-visible="false">Fecha registro</th>
                                    <th class="col-md-1" data-field="fecha_mantenimiento" data-halign="left" data-align="center" data-visible="false">Registrado :</th>
								
		
								</tr>
							</thead>
						</table>
		
					</div>
					
					
					<div class="modal fade" id="modalNuevoActivo" tabindex="-1" role="dialog">
							<div class="modal-dialog modal-lg" role="document">
								<div class="modal-content">
									<form id="formActivo" v-on:submit.prevent="createActivo" method="POST" role="form" enctype="multipart/form-data">
										<div class="modal-header">
											<h4 class="modal-title">Enviar a mantenimiento recursos de la empresa</h4>
										</div>
										<!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />				 -->
										<div class="modal-body">
											<div class="row clearfix">
				
												<div class="col-md-12">
													<div class="form-group">
														<p><b>Titulo *</b></p>
														<div class="form-line">
															<input type="text" name="txtNombre" class="form-control" required="required" 
															placeholder="Escriba el nombre " v-model="newDetalle.titulo"/>
														</div>
													</div>
												</div>
											</div>
											<div class="row clearfix">
												<div class="col-md-6">
														<b>Catalogo *</b>
														<div class="input-group">	                            
															<select class="form-control show-tick cmbCatalogo" name="cmbCatalogo" id="cmbCatalogo" v-model="newDetalle.id_catalogo">
																<option value="default" selected="selected">Selecciona un Catalogo...</option>
																<option v-for="item in catalogo" :value="item.id_catalogo_activo" :data-subtext="item.nombre">{{ item.nombre }}</option>
															</select>
														</div>
												</div>
												<div class="col-md-6">
														<b>Lista de Recursos *</b>
														<div class="input-group">	                            
															<select class="form-control show-tick cmbRecurso" name="cmbRecurso" id="cmbRecurso" v-model="newDetalle.id_activo_mobiliario">
																<option value="default" selected="selected">Selecciona un Recurso...</option>
																<option v-for="item in recursoActivo" :value="item.id_activo_mobiliario">{{ item.descripcion_completa }}</option>
															</select>
														</div>
												</div>
											</div>

											<div class="row-clearfix">
												<div class="col-md-12">
													<p><b>Diagnostico</b></p>
													<div class="form-line">
														<textarea rows="4"  name="txtObservaciones" class="form-control no-resize col-md-6" 
														placeholder="Defina los diagnosticos el motivo de mandar a mantenimiento" v-model="newDetalle.observaciones"></textarea>
													</div>
												</div>
											</div>
											<div class="row-clearfix">
												<div class="col-md-12">
													<p><b>Falla</b></p>
													<div class="form-line">
														<textarea rows="4"  name="txtObservaciones" class="form-control no-resize col-md-6" 
														placeholder="Cuales son las fallas que presenta" v-model="newDetalle.observaciones"></textarea>
													</div>
												</div>
											</div>
										<div class="row-clearfix">
												<div class="col-md-12 text-center">
														<canvas style="background:#fff; border:1px solid #ccc; width:500px; height:500px;"></canvas>
														<div style="display:none;" class="container-fluid">
															<img id="source" :src="newDetalle.urlfichero" style="width: 100%" height="100%" />
														</div>
												</div>
												<div class="col-md-6 col-md-offset-3 text-center">
													<a id="btnLimpiar" href="javascript:void(0)" class="btn btn-warning">Limpiar</a>
													<a id="btnGenerar" href="javascript:void(0)" class="btn btn-success">Generar Imagen</a>
												</div>
										</div>

										<div class="row clearfix m-t-5">
												<div class="col-md-12">
													<div class="form-group" >	
														<p><b>Subir Im&aacute;gen de evidencia generada</b></p>							
														<div class="form-line">
															<input type="file" name="fichero" id="idFileActivo" class="form-control-file" multiple="multiple" />
															<!-- <input type="file" name="fichero" @change="onFileChange" class="form-control" multiple="multiple"/> -->
														</div>
													</div>
													<!-- <div v-else>
														<img :src="newActivo.fichero"/>
														<button class="btn-danger" @click="removeImage">Quitar Imagen</button>
													</div> -->
												</div>
					
											</div>

											<div class="row clearfix">
												<div class="col-xs-6 col-sm-6 col-md-6">
													<p><b>Fecha de envio a mantenimiento</b></p>
													<div class="input-group">
														<span class="input-group-addon">
															<i class="material-icons">date_range</i>
														</span>
														<div class="form-line" id='groupDesde'>
															<input type="text" class="form-control text-center datetimepicker" id="txtBootstrapTableDesde" name="txtBootstrapTableDesde" placeholder="Selecciona una fecha..." />
														</div>
													</div>
												</div>
												<div class="col-xs-4 col-sm-4 col-md-4">
													<p> <b>Gasto aproximado</b> </p>
													<div class="input-group">
														<span class="input-group-addon">
															<i class="material-icons">attach_money</i>
														</span>
														<div class="form-line" id="price">
															<input type="text" class="form-control"/>
														</div>
														<span class="input-group-text">.00</span>
													</div>
												</div>
											</div>
				

										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-danger waves-effect" data-dismiss="modal">CANCELAR</button>
											<button type="submit" class="btn btn-primary waves-effect">CREAR</button>
										</div>
										
									</form>
								</div>
							</div>
						</div>


    			</div>

			</div>
		</div>
    </div>
    
	</div>


</th:block>
<th:block th:fragment="script">

    <script th:src="@{/plugins/vue/vue.js}"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script th:src="@{/assets/js/DetalleActivo.js}"></script>
	<!-- Wenzhixin DataTable -->
	<script th:src="@{/plugins/wenzhixin/bootstrap-table.js}"></script>
	<script th:src="@{/plugins/wenzhixin/extensions/export/tableExport.js}"></script>
	<script th:src="@{/plugins/wenzhixin/extensions/export/bootstrap-table-export.js}"></script>
	<script th:src="@{/plugins/wenzhixin/locale/bootstrap-table-es-MX.js}"></script>
	<script type="application/javascript" th:inline="javascript">

			$("#dtDetalle").bootstrapTable({
			url					: [[@{/controlPanel/DetalleMant/table}]],
			method				: 'post',
			contentType 		: 'application/x-www-form-urlencoded',
			sidePagination		: "server",
			pagination			: true,
			showColumns			: true,
			showToggle 			: true,
			showRefresh 		: true,
			search				: true,
			showExport			: true,
			striped				: true,
			pageSize 			: 10,
			sortable			: true,
			exportTypes			: ["excel"],
			toolbar				: "#dtDetalleToolBar",
			queryParams 		: function(params) {
										params[ [[${_csrf.parameterName}]] ] = [[${_csrf.token}]];
										params['txtBootstrapTableDesde'] = $('#txtBootstrapTableDesde').val();
										params['txtBootstrapTableHasta'] = $('#txtBootstrapTableHasta').val();
							        	return params;
		    }
		});


		function accionesFormatter(value, row, index) {
			//urlDelete = [[@{/controlPanel/activos/}]] + row.id_activo_mobiliario + '/delete';
		    return [
				'<a href="#" title="Imprimir" class="ImprimirActivo">',
					'<i class="material-icons print">print</i>',
				'</a>',
				'<a href="#" title="Historial" class="Historial">',
					'<i class="material-icons format_list_numbered">format_list_numbered</i>',
				'</a>',
				'<a href="#" title="Pagar" class="Pagar">',
					'<i class="material-icons attach_money">attach_money</i>',
					'</a>'
			].join(''); 
		}

		function estatusFormatter(value, row, index){
			var lblEstatus='';
			switch(row.finalizado){
				case false:
					lblEstatus ='<a type="button" class="btn bg-orange waves-effect" > En Mantenimiento </a>';
					break;
				default:
					lblEstatus='<a type="button" class="btn bg-green waves-effect" > Finalizado </a>';
					break;
			}
			return lblEstatus;
		}

		$(function () {
			//Datetimepicker plugin
		    $('.datetimepicker').bootstrapMaterialDatePicker({
		        format: 'DD/MM/YYYY',
		        clearButton: true,
		        weekStart: 1,
		        time:false
		    });
		 });
		 


			var canvas = document.querySelector( 'canvas' ),
                c = canvas.getContext( '2d' ),
				mouseX = 0,
                mouseY = 0,
                width = 500,
                height = 400,
                colour = 'red',
                mousedown = false;

            // resize the canvas
            canvas.width = width;
            canvas.height = height;

			var img = document.getElementById("source");
			
			img.addEventListener('load', e => {
			  c.drawImage(img,0,0);
			});
			  function draw() {
                if (mousedown) {
                    // set the colour
                    c.fillStyle = colour;
                    c.globalAlpha = 0.5
                    // start a path and paint a circle of 20 pixels at the mouse position
                    c.beginPath();
                    c.arc( mouseX, mouseY, 10 , 0, Math.PI*2, true );
                    c.closePath();
                    c.fill();
                }
            }

            // get the mouse position on the canvas (some browser trickery involved)
            canvas.addEventListener( 'mousemove', function( event ) {
                if( event.offsetX ){
                    mouseX = event.offsetX;
                    mouseY = event.offsetY;
                } else {
                    mouseX = event.pageX - event.target.offsetLeft;
                    mouseY = event.pageY - event.target.offsetTop;
                }

                // call the draw function
                draw();
            }, false );

            canvas.addEventListener( 'mousedown', function( event ) {
                mousedown = true;
            }, false );

            canvas.addEventListener( 'mouseup', function( event ) {
                mousedown = false;
            }, false );

            $('#btnGenerar').click(function() {
                var dataURL = canvas.toDataURL('image/jpeg', 1);
                dataURL = dataURL.replace("image/jpeg", "image/octet-stream");
                document.location.href = dataURL;
            });

            $('#btnLimpiar').click(function() {
                c.clearRect(0, 0, canvas.width, canvas.height);
                c.drawImage(img,0,0);
            });

    // c.drawImage(img,0,0);
		
    </script>

</th:block>