<th:block th:fragment="body">
	<div id="appCatalogoActivos">

	<div class="block-header">
		<h2>Catalogo Activo de IBMexico</h2>
	</div>

	<ol class="breadcrumb breadcrumb-bg-red">
		<li><a th:href="${ {_PATH_} + 'controlPanel/'}"><i class="material-icons">home</i> Inicio</a></li>
		<li class="active"><i class="material-icons">public</i> Catalogos Activos</li>
	</ol>

	<div class="row clearfix">
		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
			<div class="card">
				<div class="header">
					<h2>LISTA DE CATALOGOS</h2>
				</div>
		
    			<div class="body">
    				<div class="row clearfix">
					<!--<div class="row clearfix" th:if="${rolNuevoCliente}">-->
    					<div class="col-md-4 col-md-offset-8 text-right">
							<!--th:href="${ {_PATH_} + 'controlPanel/catalogoActivo/create'}" -->
							<a href="#" role="button" class="btn bg-purple waves-effect" 
								data-toggle="modal" data-target="#modalNuevaCategoria">
								<i class="material-icons">add_circle</i> Nuevo Catalogo</a>
    					</div>
    				</div>
    			
    				<div class="row clearfix" id="dtActivosToolBar">
    					<div class="col-xs-3 col-sm-3 col-md-3">
    						<div class="input-group">
   								<span class="input-group-addon">
                                	<i class="material-icons">date_range</i>
	                           	</span>
	                           	<div class="form-line" id='groupDesde'>
                               		<input type="text" class="form-control text-center datetimepicker" id="txtBootstrapTableDesde" name="txtBootstrapTableDesde" placeholder="Desde..." />
	                           	</div>
							</div>
    					</div>
    					
    					<div class="col-xs-3 col-sm-3 col-md-3">
    						<div class="input-group">
    							<span class="input-group-addon">
                                	<i class="material-icons">date_range</i>
	                           	</span>
	                           	<div class="form-line" id='groupHasta'>
                               		<input type="text" class="form-control text-center datetimepicker" id="txtBootstrapTableHasta" name="txtBootstrapTableHasta" placeholder="Hasta..." />
	                           	</div>
							</div>
    					</div>					
					</div>

					<div class="table-responsive">
						<table id="dtActivos" class="table table-bordered table-striped table-hover">
							<thead>
								<tr>
									<th class="col-md-1" data-field="idCatalogoActivo" data-halign="left" data-align="center">ID</th>
									<th class="col-md-3" data-field="nombre" data-halign="left">Nombre</th>
									<th class="col-md-4" data-field="descripcion" data-halign="left">Descripci&oacute;n</th>

									<th class="col-md-1" data-field="fecharegistro" data-halign="left" data-align="center" data-visible="false">Fecha registro</th>
		
									<th class="col-md-1" data-formatter="accionesFormatter" data-align="center">Acciones</th>
								</tr>
							</thead>
						</table>
		
					</div>
					
    			</div>

			</div>
		</div>
	</div>

			<!-- NUEVA COTIZACION -->
		<div class="modal fade" id="modalNuevaCategoria" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<form id="formCatalogoActivo" v-on:submit.prevent="createCatalogo" method="POST" role="form">
						<div class="modal-header">
							<h4 class="modal-title">Nueva Catalogo</h4>
						</div>
						<!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> -->
						<div class="modal-body">
							<div class="row clearfix">

								<div class="col-md-4">
									<div class="form-group">
										<p><b>Nombre *</b></p>
										<div class="form-line">
											<input type="text" name="txtNombre" class="form-control" required="required" v-model="nombre"/>
										</div>
									</div>
								</div>
								
								<div class="col-md-4">
									<div class="form-group">
										<p><b>Descripci&oacute;n *</b></p>
										<div class="form-line">
											<input type="text" name="txtDescripcion" class="form-control" required="required" v-model="descripcion"/>
										</div>
									</div>
								</div>

							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-danger waves-effect" data-dismiss="modal">CANCELAR</button>
							<button type="submit" class="btn btn-primary waves-effect">CREAR</button>
						</div>
						
					</form>
				</div>
			</div>
		</div>
	</div>


</th:block>
<th:block th:fragment="script">

	<script th:src="@{/plugins/vue/vue.js}"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script th:src="@{/assets/js/activos.js}"></script>
	<!-- Wenzhixin DataTable -->
	<script th:src="@{/plugins/wenzhixin/bootstrap-table.js}"></script>
	<script th:src="@{/plugins/wenzhixin/extensions/export/tableExport.js}"></script>
	<script th:src="@{/plugins/wenzhixin/extensions/export/bootstrap-table-export.js}"></script>
	<script th:src="@{/plugins/wenzhixin/locale/bootstrap-table-es-MX.js}"></script>
	<script type="application/javascript" th:inline="javascript">

			$("#dtActivos").bootstrapTable({
			url					: [[@{/controlPanel/catalogoActivo/table}]],
			method				: 'post',
			contentType 		: 'application/x-www-form-urlencoded',
			sidePagination		: "server",
			pagination			: true,
			showColumns			: true,
			showToggle 			: true,
			showRefresh 		: true,
			search				: true,
			showExport			: true,
			striped				: true,
			pageSize 			: 30,
			exportTypes			: ["excel"],
			toolbar				: "#dtActivosToolBar",
			queryParams 		: function(params) {
										params[ [[${_csrf.parameterName}]] ] = [[${_csrf.token}]];
										params['txtBootstrapTableDesde'] = $('#txtBootstrapTableDesde').val();
										params['txtBootstrapTableHasta'] = $('#txtBootstrapTableHasta').val();
							        	return params;
		    }, onLoadSuccess :function(data){
				$(".deleteCatalogo").click(function(){
					var idCatalogoActivo=$(this).attr('data-catalogo');

					swal({
							title	: "Eliminar Activo",
							text	: "Se eliminara un activo en el sistema.",
							type	: "warning",
							showCancelButton: true,
							cancelButtonText: 'Cancelar',
							confirmButtonText: 'Eliminar',
						}).then((result) => {
							if(result) {
								
								$.ajax({
									url			: [[@{/controlPanel/catalogoActivo/}]] + idCatalogoActivo + '/delete',
									data		: {
													idCatalogoActivo : idCatalogoActivo, 
													[[${_csrf.parameterName}]] : [[${_csrf.token}]]
									},							        
									dataType	: 'json',
									type		: "POST",
									success		: function(data) {
										if(data.respuesta) {				
											$("#dtActivos").bootstrapTable('refresh');
											swal(data.titulo, data.mensaje,'success');
										}
									},
									error		: function(e) {
										console.log(e);										
									}
								});																													
							}
						}).catch(swal.noop);

				});

			}
		});
		
		function accionesFormatter(value, row, index) {
			//urlDelete = [[@{/controlPanel/catalogoActivo/}]] + row.idCatalogoActivo + '/delete';
		    return [
		        '<a href="#" title="Eliminar" class="deleteCatalogo" data-catalogo="'+row.idCatalogoActivo+'">',
		        	'<i class="material-icons remove">delete</i>',
		        '</a>'
			].join(''); 
		}

		$(function () {
		// VALIDADOR DE FORMULARIO
			$('#formCatalogoActivo').validate({
		        rules: {
		            'txtNombre': {
		                required: true
		            },
		            'txtDescripcion': {
		                required: true
		            }
		        },
		        highlight: function (input) {
		            $(input).parents('.form-line').addClass('error');
		        },
		        unhighlight: function (input) {
		            $(input).parents('.form-line').removeClass('error');
		        },
		        errorPlacement: function (error, element) {
		            $(element).parents('.form-group').append(error);
		        }
			});
		});
		
	</script>

</th:block>