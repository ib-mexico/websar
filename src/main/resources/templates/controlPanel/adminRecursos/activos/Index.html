<th:block th:fragment="body">
	<div id="appActivos">

	<div class="block-header">
		<h2>Recursos Activos de IBMEXICO</h2>
	</div>

	<ol class="breadcrumb breadcrumb-bg-red">
		<li><a th:href="${ {_PATH_} + 'controlPanel/'}"><i class="material-icons">home</i> Inicio</a></li>
		<li class="active"><i class="material-icons">public</i> Nuevos Activos</li>
	</ol>

	<div class="row clearfix">
		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
			<div class="card">
				<div class="header">
					<h2>Lista de Recursos Activos</h2>
				</div>
		
    			<div class="body">
    				<div class="row clearfix">
					<!--<div class="row clearfix" th:if="${rolNuevoCliente}">-->
    					<div class="col-md-4 col-md-offset-8 text-right">
							<!--th:href="${ {_PATH_} + 'controlPanel/activos/create'}" -->
							<a href="#" role="button" class="btn bg-purple waves-effect" 
								data-toggle="modal" data-target="#modalNuevoActivo" v-on:click="loadModal">
								<i class="material-icons">add_circle</i> Nuevo</a>
    					</div>
    				</div>

					<div class="table-responsive">
						<table id="dtActivo" class="table table-bordered table-striped table-hover">
							<thead>
								<tr>
									<th class="col-md-1" data-field="id_activo_mobiliario" data-halign="left" data-align="center">ID</th>
									<th class="col-md-3" data-field="nombre" data-halign="left">Nombre</th>
                                    <th class="col-md-4" data-field="marca" data-halign="left">Marca</th>
                                    <th class="col-md-3" data-field="modelo" data-halign="left">Modelo</th>
                                    <th class="col-md-3" data-field="color" data-halign="left">Color</th>
                                    <th class="col-md-3" data-field="Catalogo" data-halign="left">Catalogo</th>


                                    <th class="col-md-1" data-field="creacion_fecha" data-halign="left" data-align="center" data-visible="false">Fecha registro</th>
                                    <th class="col-md-1" data-field="creacion_id_usuario" data-halign="left" data-align="center" data-visible="false">Registrado :</th>
		
									<th class="col-md-1" data-formatter="accionesFormatter" data-align="center">Acciones</th>
								</tr>
							</thead>
						</table>
		
					</div>
					
    			</div>

			</div>
		</div>
	</div>



			<!-- NUEVA ACTIVO -->
		<div class="modal fade" id="modalNuevoActivo" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<form id="formActivo" v-on:submit.prevent="createActivo" method="POST" role="form">
						<div class="modal-header">
							<h4 class="modal-title">Nuevo Activo</h4>
						</div>
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />				
						<div class="modal-body">
							<div class="row clearfix">

								<div class="col-md-4">
									<div class="form-group">
										<p><b>Nombre *</b></p>
										<div class="form-line">
											<input type="text" name="txtNombre" class="form-control" required="required" 
											placeholder="Escriba el nombre " v-model="newActivo.nombre"/>
										</div>
									</div>
								</div>
								<div class="col-md-4">
									<b>Empresa *</b>
									<div class="input-group">
										<select name="cmbEmpresa" id="cmbEmpresa" class="form-control show-tick cmbEmpresa" v-model="newActivo.id_empresa">
											<option value="default" selected="selected">Selecciona la empresa...</option>
											<option v-for="item in empresas" :value="item.id_empresa" >{{item.razon_social}}</option>
										</select>
									</div>
								</div>
                                
                                <div class="col-md-4">
                                        <b>Catalogo *</b>
                                        <div class="input-group">	                            
                                            <select class="form-control show-tick cmbCatalogo" name="cmbCatalogo" id="cmbCatalogo" v-model="newActivo.id_activo">
                                                <option value="default" selected="selected">Selecciona un Catalogo...</option>
                                                <option v-for="item in catalogo" :value="item.id_catalogo_activo" :data-subtext="item.nombre">{{ item.nombre }}</option>
                                            </select>
                                        </div>
								</div>
								<div class="col-md-4">
									
									<div class="form-group" v-if="newActivo.id_activo==2">
										<p><b>Opcionales</b></p>
										<div class="form-line">
											<input type="text" name="txtOpcional" class="form-control" placeholder="opcional"/>
										</div>
									</div>

								</div>

                            </div>
                            
                            <div class="row clearfix">

                                <div class="col-md-4">
                                    <div class="form-group">
                                            <p><b>Marca</b></p>
                                            <div class="form-line">
												<input type="text" name="txtMarca" class="form-control" 
												placeholder="Escriba la marca" required="required" v-model="newActivo.marca"/>
                                            </div>
                                        </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <p><b>Modelo</b></p>
                                        <div class="form-line">
											<input type="text" name="txtModelo" class="form-control" 
											placeholder="Escriba el modelo" v-model="newActivo.modelo"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                        <div class="form-group">
                                            <p><b>Color</b></p>
                                            <div class="form-line">
												<input type="text" name="txtColor" class="form-control" required="required" 
												placeholder="Escriba el color .." v-model="newActivo.color"/>
                                            </div>
                                        </div>
								</div>

							</div>
							<div class="row clearfix">
								<div class="col-md-4">
									<div class="form-group">
										<p><b>Serie</b></p>
										<div class="form-line">
											<input type="text" name="txtSerie" class="form-control" required="required" 
											placeholder="Escriba la serie" v-model="newActivo.serie"/>
										</div>
									</div>
								</div>
								<div class="col-md-8">
									<p><b>Observaciones</b></p>
									<div class="form-line">
										<textarea rows="4"  name="txtObservaciones" class="form-control no-resize col-md-6" 
										placeholder="Escriba en que condiciones se encuentra" v-model="newActivo.observaciones"></textarea>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-danger waves-effect" data-dismiss="modal">CANCELAR</button>
							<button type="submit" class="btn btn-primary waves-effect">CREAR</button>
						</div>
						
					</form>
				</div>
			</div>
		</div>


			<!-- EDIT ACTIVO -->
			<div class="modal fade" id="modalEditActivo" tabindex="-1" role="dialog">
					<div class="modal-dialog modal-lg" role="document">
						<div class="modal-content">
							<form id="formEditActivo" v-on:submit.prevent="update" method="POST" role="form">
								<div class="modal-header">
									<h4 class="modal-title">Editar Activo</h4>
								</div>
						<!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />-->
						<!-- v-for=" data in editData" -->
								<div class="modal-body"> 
									<div class="row clearfix">
						<!-- <input type="hidden" :value="data.id_activo_mobiliario" name="txt_id_activo_mobiliario"/> -->
										<div class="col-md-4">
											<div class="form-group">
												<p><b>Nombre *</b></p>
												<div class="form-line">
													<input type="text" name="txtNombre" class="form-control" required="required" 
													   v-model="editData.nombre" />
												</div>
											</div>
										</div>
										<div class="col-md-4">
											<b>Empresa *</b>
											<div class="input-group">
												<select name="cmbEmpresa"  class="form-control show-tick cmbEmpresa" v-model="elegido" data-live-search="true">
													<!-- <option v-if="data.id_empresa" value="data.id_empresa" selected="selected">{{data.id_empresa}}</option> -->
													<!-- <option value="default" selected="selected">Selecciona la empresa...</option> -->
													<option v-for="(item, key) in empresas" :value="item.id_empresa"> {{item.razon_social}} </option>
												</select>
												<!-- <span>{{editData.id_empresa}}</span> -->
											</div>
										</div>
										
										<div class="col-md-4">
												<b>Catalogo *</b>
												<div class="input-group">	                            
													<select class="form-control show-tick cmbCatalogo" name="cmbCatalogo"  v-model="editData.id_activo">
														<option value="default" selected="selected">Selecciona un Catalogo...</option>
														<option v-for="item in catalogo" :value="item.id_catalogo_activo" :data-subtext="item.nombre">{{ item.nombre }}</option>
													</select>
												</div>
										</div>
		
									</div>
									
									<div class="row clearfix">
		
										<div class="col-md-4">
											<div class="form-group">
													<p><b>Marca</b></p>
													<div class="form-line">
														<input type="text" name="txtMarca" class="form-control" 
														placeholder="Escriba la marca" required="required" v-model="editData.marca"/>
													</div>
												</div>
										</div>
										<div class="col-md-4">
											<div class="form-group">
												<p><b>Modelo</b></p>
												<div class="form-line">
													<input type="text" name="txtModelo" class="form-control" 
													placeholder="Escriba el modelo" v-model="editData.modelo"/>
												</div>
											</div>
										</div>
										<div class="col-md-4">
												<div class="form-group">
													<p><b>Color</b></p>
													<div class="form-line">
														<input type="text" name="txtColor" class="form-control" required="required" 
														placeholder="Escriba el color .." v-model="editData.color"/>
													</div>
												</div>
										</div>
		
									</div>
									<div class="row clearfix">
										<div class="col-md-4">
											<div class="form-group">
												<p><b>Serie</b></p>
												<div class="form-line">
													<input type="text" name="txtSerie" class="form-control" required="required" 
													placeholder="Escriba la serie" v-model="editData.serie"/>
												</div>
											</div>
										</div>
										<div class="col-md-6">
											<p><b>Observaciones</b></p>
											<div class="form-line">
												<textarea rows="4"  name="txtObservaciones" class="form-control no-resize col-md-6" 
												placeholder="Escriba en que condiciones se encuentra" v-model="editData.observaciones"></textarea>
											</div>
										</div>
									</div>
								</div>
								<div class="modal-footer">
									<button onclick="cancel();" type="button" class="btn btn-danger waves-effect" data-dismiss="modal">CANCELAR</button>
									<button type="submit" class="btn btn-primary waves-effect">CREAR</button>
								</div>
								
							</form>
						</div>
					</div>
				</div>

	</div>


</th:block>
<th:block th:fragment="script">

	<script th:src="@{/plugins/vue/vue.js}"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script th:src="@{/assets/js/activos.js}"></script>
	<!-- Wenzhixin DataTable -->
	<script th:src="@{/plugins/wenzhixin/bootstrap-table.js}"></script>
	<script th:src="@{/plugins/wenzhixin/extensions/export/tableExport.js}"></script>
	<script th:src="@{/plugins/wenzhixin/extensions/export/bootstrap-table-export.js}"></script>
	<script th:src="@{/plugins/wenzhixin/locale/bootstrap-table-es-MX.js}"></script>
	<script type="application/javascript" th:inline="javascript">

			$("#dtActivo").bootstrapTable({
			url					: [[@{/controlPanel/BienActivo/table}]],
			method				: 'post',
			contentType 		: 'application/x-www-form-urlencoded',
			sidePagination		: "server",
			pagination			: true,
			showColumns			: true,
			showToggle 			: true,
			showRefresh 		: true,
			search				: true,
			showExport			: true,
			striped				: true,
			pageSize 			: 30,
			exportTypes			: ["excel"],
			toolbar				: "#dtActivoToolBar",
			queryParams 		: function(params) {
										params[ [[${_csrf.parameterName}]] ] = [[${_csrf.token}]];
										params['txtBootstrapTableDesde'] = $('#txtBootstrapTableDesde').val();
										params['txtBootstrapTableHasta'] = $('#txtBootstrapTableHasta').val();
							        	return params;
		    }, onLoadSuccess :function(data){
				$(".deleteActivo").click(function(){
					var idActivo=$(this).attr('data-activo');

					swal({
							title	: "Eliminar Activo",
							text	: "Se eliminara un activo en el sistema.",
							type	: "warning",
							showCancelButton: true,
							cancelButtonText: 'Cancelar',
							confirmButtonText: 'Eliminar',
						}).then((result) => {
							if(result) {
								
								$.ajax({
									url			: [[@{/controlPanel/BienActivo/}]] + idActivo + '/delete',
									data		: {
													idActivo : idActivo, 
													[[${_csrf.parameterName}]] : [[${_csrf.token}]]
									},							        
									dataType	: 'json',
									type		: "POST",
									success		: function(data) {
										if(data.respuesta) {				
											$("#dtActivo").bootstrapTable('refresh');
											swal(data.titulo, data.mensaje,'success');
										}
									},
									error		: function(e) {
										console.log(e);										
									}
								});																													
							}
						}).catch(swal.noop);

				});

			}
		});

		function edit(param){			
			NuevoActivo.editActivo(param);
		}

		function accionesFormatter(value, row, index) {
			//urlDelete = [[@{/controlPanel/activos/}]] + row.id_activo_mobiliario + '/delete';
		    return [
				'<a href="#" title="Editar" class="EditActivo" data-Edit="'+row.id_activo_mobiliario+'" data-toggle="modal" data-target="#modalEditActivo" onclick="edit('+row.id_activo_mobiliario+');" role="button">',
					'<i class="material-icons edit">edit</i>',
				'</a>',
				'<a href="#" title="Eliminar" class="deleteActivo" data-activo="'+row.id_activo_mobiliario+'">',
		        	'<i class="material-icons remove">delete</i>',
				'</a>'
			].join(''); 
		}

		$(function () {
		// VALIDADOR DE FORMULARIO
			$('#formActivo').validate({
		        rules: {
		            'txtNombre': {
		                required: true
		            },
		            'txtMarca': {
		                required: true
					},
					'txtModelo':{
						required: false
					},
					'txtColor':{
						required: false
					},
					'txtSerie':{
						required: true
					},
					'txtObservaciones':{
						required: true
					}
		        },
		        highlight: function (input) {
		            $(input).parents('.form-line').addClass('error');
		        },
		        unhighlight: function (input) {
		            $(input).parents('.form-line').removeClass('error');
		        },
		        errorPlacement: function (error, element) {
		            $(element).parents('.form-group').append(error);
		        }
			});
			 
		});
		
		function cancel(){
			$('#formEditActivo')[0].reset();
			this.NuevoActivo.editData={};
			this.NuevoActivo.elegido="";
			// this.NuevoActivo.editData.nombre="";
			// this.NuevoActivo.editData.marca="";
			// this.NuevoActivo.editData.modelo="";
			// this.NuevoActivo.editData.color="";
			// this.NuevoActivo.editData.serie="";
			// this.NuevoActivo.editData.observaciones="";
			// this.NuevoActivo.editData.id_empresa='default';
			// this.NuevoActivo.editData.id_activo='default';
			// this.NuevoActivo.editData.id_activo_mobiliario='default';
		}
		$('#modalEditActivo').on('hidden.bs.modal',function(){
				// $('#formEditActivo')[0].reset();
				cancel();
			});
	</script>

</th:block>